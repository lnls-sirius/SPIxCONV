# SPIxCONV.proto

@mismatch { in "%*#s"; in "%*#s"; }

# Protocol for SPIxCONV boards. Developed for SPIxCONV version 1.1 and newer
# Protocol doesn't have any terminator character
Terminator = CR LF;

# An outcoming message should wait at most 10 s to be sent
LockTimeout = 10000;

# The timeout involved in reading operations is 25 ms
#ReadTimeout = 500;
ReadTimeout = 5;

# The application should wait at most 100 ms for a board to answer
#ReplyTimeout = 1000;
ReplyTimeout = 100;

#==============================================================================
config{
    # output parameters: board
    out 0x01, $1;
    in 0x01, 0x01;
}
#==============================================================================
set_portA_direction_bit{
    # output parameters: board, bit, value
    out 0x01, $1, "A", $2, "%(RVAL)i";
    in 0x01, 0x01;
}
set_portB_direction_bit{
    # output parameters: board, bit, value
    out 0x01, $1, "B", $2, "%(RVAL)i";
    in 0x01, 0x01;
}
set_portC_direction_bit{
    # output parameters: board, bit, value
    out 0x01, $1, "C", $2, "%(RVAL)i";
    in 0x01, 0x01;
}
set_portD_direction_bit{
    # output parameters: board, bit, value
    out 0x01, $1, "D", $2, "%(RVAL)i";
    in 0x01, 0x01;
}
#==============================================================================
set_analog_output{
    @init{
        # output parameters: board
        out 0x10, "\$1,", "\$2,", "\$3,", "\$4,";
        # input parameters:  code set
        in 0x10, 0x01, "%u";
    }
    # output parameters: board, voltage
    out 0x02, $1, "%(RVAL)i";
    in 0x02, 0x01;
}
#==============================================================================
set_analog_output_2{
    #@init{
    #    read_analog_output_2;
    #}
    out 0x22, 0x00, "%u";
    in 0x22, 0x01;
}
#==============================================================================
set_analog_output_3{
    #@init{
    #    read_analog_output_3;
    #}
    out 0x32, 0x00, "%u";
    in 0x32, 0x01;
}
#==============================================================================
read_analog_output{
    @init{
        # output parameters: board
        out 0x03, $1;
        # input parameters:  code set
        in 0x03, 0x01, "%u";
    }
    # output parameters: board
    out 0x03, $1;
    # input parameters:  code set
    in 0x03, 0x01, "%u";
}
#==============================================================================
read_analog_output_2{
    out 0x23, 0x00;
    in 0x23, 0x01, "%u";
}
#==============================================================================
read_analog_output_3{
    out 0x33, 0x00;
    in 0x33, 0x01, "%u";
}
#==============================================================================
read_analog_input{
    # output parameters: board
    out 0x04, $1;
    # input parameters:  raw voltage
    in 0x04, 0x01, "%u";
}
#==============================================================================
read_analog_input_2{
    out 0x24, 0x00;
    in 0x24, 0x01, "%u";
}
#==============================================================================
read_analog_input_3{
    out 0x34, 0x00;
    in 0x34, 0x01, "%u";
}
#==============================================================================
set_digital_output_byte{
    # output parameters: board, value
    out 0x05, $1, $2;
    in 0x05, 0x01;
}
#==============================================================================
read_digital_input_byte{
    #MaxInput = 3;
    # output parameters: board
    out 0x07, $1;
    # input parameters:  byte read
    in 0x07, 0x01, "%d";
}
#==============================================================================
reset{
    # output parameters: board
    out 0x09, $1, "%(RVAL)i";
    in 0x09, 0x01;
}
#==============================================================================
read_interlock_labels{
    Separator = ",";
    out 0x0A;
    in 0x0A, 0x01, "%#s";
}
#==============================================================================
read_portB_digital_output_bit{
    #MaxInput = 3;
    # output parameters: board, bit
    out 0x0B, $1, $2;
    # input parameters:  bit read
    in 0x0B, 0x01, "%u";
}
#==============================================================================
set_portB_digital_output_bit{
    #MaxInput = 3;
    @init{
        # output parameters: board, bit
        out 0x0B, $1, $2;
        # input parameters:  bit read
        in 0x0B, 0x01, "%u";
    }

    # output parameters: board, bit, value
    out 0x0C, $1, $2, "%(RVAL)i";
    in 0x0C, 0x01;
}
#==============================================================================
read_portA_digital_input_bit{
    #MaxInput = 3;
    # output parameters: board, bit_pos
    out 0x11, $1, $2;
    # input parameters:  bit read
    in 0x11, 0x01, "%u";
}
#==============================================================================
read_portB_digital_input_bit{
    #MaxInput = 3;
    # output parameters: board, bit_pos
    out 0x0E, $1, $2;
    # input parameters:  bit read
    in 0x0E, 0x01, "%u";
}